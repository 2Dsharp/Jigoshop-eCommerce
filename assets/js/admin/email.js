var AdminEmail,bind=function(e,t){return function(){return e.apply(t,arguments)}};AdminEmail=function(){function e(){this.addAttachments=bind(this.addAttachments,this),jQuery("#jigoshop_email_actions").on("change",this.updateVariables),jQuery("#email-attachments").on("click",".delete",function(e){return jQuery(e.target).parent().remove()}),jQuery(".add-email-attachments").on("click",this.addAttachments)}return e.prototype.wpMedia=!1,e.prototype.updateVariables=function(e){var t;return e.preventDefault(),t=jQuery(e.target).closest("div.jigoshop"),jQuery.ajax({url:jigoshop.getAjaxUrl(),type:"post",dataType:"json",data:{action:"jigoshop.admin.email.update_variable_list",email:t.data("id"),actions:jQuery(e.target).val()}}).done(function(e){return null!=e.success&&e.success?jQuery("#available_arguments").replaceWith(e.html):jigoshop.addMessage("danger",e.error,6e3)})},e.prototype.addAttachments=function(e){var t;return e.preventDefault(),t?void this.wpMedia.open():(this.wpMedia=wp.media({states:[new wp.media.controller.Library({filterable:"all",multiple:!0})]}),t=this.wpMedia,this.wpMedia.on("select",function(){var e,a;return a=t.state().get("selection"),e=jQuery.map(jQuery('input[name="jigoshop_email[attachments][]"]'),function(e){return parseInt(jQuery(e).val())}),a.map(function(t){var a;return t=t.toJSON(),t.id&&-1===jQuery.inArray(t.id,e)?(a=wp.template("product-downloads"),jQuery("#email-attachments").append(a({id:t.id,title:t.filename}))):void 0})}),t.open())},e}(),jQuery(function(){return new AdminEmail});