var AdminProductVariable,bind=function(t,e){return function(){return t.apply(e,arguments)}};AdminProductVariable=function(){function t(t){this.params=t,this.removeVariation=bind(this.removeVariation,this),this.updateVariation=bind(this.updateVariation,this),jQuery("#product-type").on("change",this.removeParameters),jQuery("#add-variation").on("click",this.addVariation),jQuery("#product-variations").on("click",".remove-variation",this.removeVariation).on("click",".show-variation",function(t){var e;return e=jQuery(t.target),jQuery(".list-group-item-text",e.closest("li")).slideToggle(function(){return jQuery("span",e).toggleClass("glyphicon-collapse-down").toggleClass("glyphicon-collapse-up")})}).on("change","select.variation-attribute",this.updateVariation).on("change",".list-group-item-text input.form-control, .list-group-item-text select.form-control",this.updateVariation).on("click",".set_variation_image",this.setImage).on("click",".remove_variation_image",this.removeImage).on("change",'input[type="checkbox"].default_variation',function(t){return jQuery('input[type="checkbox"].default_variation').not(jQuery(t.target)).prop("checked",!1)}),jQuery(".set_variation_image").each(this.connectImage),jQuery("#product-variations")}return t.prototype.params={i18n:{confirm_remove:"",variation_removed:""}},t.prototype.removeParameters=function(t){var e;return e=jQuery(t.target),"variable"===e.val()?jQuery(".product_regular_price_field").slideUp():void 0},t.prototype.addVariation=function(t){var e;return t.preventDefault(),e=jQuery("#product-variations"),jQuery.ajax({url:jigoshop.getAjaxUrl(),type:"post",dataType:"json",data:{action:"jigoshop.admin.product.add_variation",product_id:e.closest(".jigoshop").data("id")}}).done(function(t){return null!=t.success&&t.success?jQuery(t.html).hide().appendTo(e).slideDown().trigger("jigoshop.variation.add"):jigoshop.addMessage("danger",t.error,6e3)})},t.prototype.updateVariation=function(t){var e,r,a,i,o,n,s,u,d,c,p,g,l;for(e=jQuery("#product-variations"),r=jQuery(t.target).closest("li.list-group-item"),o=function(t){return"checkbox"===t.type||"radio"===t.type?t.checked:"select-multiple"===t.type?jQuery(t).val():t.value},a={},i=jQuery("select.variation-attribute",r).toArray(),n=0,u=i.length;u>n;n++)c=i[n],l=/(?:^|\s)product\[variation]\[\d+]\[attribute]\[(.*?)](?:\s|$)/g.exec(c.name),a[l[1]]=o(c);for(p={},g=jQuery(".list-group-item-text input.form-control, .list-group-item-text select.form-control",r).toArray(),s=0,d=g.length;d>s;s++)c=g[s],l=/(?:^|\s)product\[variation]\[\d+]\[product]\[(.*?)](\[(.*?)])?(?:\s|$)/g.exec(c.name),null!=l[3]?(p[l[1]]={},p[l[1]][l[3]]=o(c)):p[l[1]]=o(c);return jQuery.ajax({url:jigoshop.getAjaxUrl(),type:"post",dataType:"json",data:{action:"jigoshop.admin.product.save_variation",product_id:e.closest(".jigoshop").data("id"),variation_id:r.data("id"),attributes:a,product:p}}).done(function(t){return function(e){return null!=e.success&&e.success?(r.trigger("jigoshop.variation.update"),jigoshop.addMessage("success",t.params.i18n.saved,2e3)):jigoshop.addMessage("danger",e.error,6e3)}}(this))},t.prototype.removeVariation=function(t){var e;return t.preventDefault(),confirm(this.params.i18n.confirm_remove)?(e=jQuery(t.target).closest("li"),jQuery.ajax({url:jigoshop.getAjaxUrl(),type:"post",dataType:"json",data:{action:"jigoshop.admin.product.remove_variation",product_id:e.closest(".jigoshop").data("id"),variation_id:e.data("id")}}).done(function(t){return function(r){return null!=r.success&&r.success?(e.trigger("jigoshop.variation.remove"),e.slideUp(function(){return e.remove()}),jigoshop.addMessage("success",t.params.i18n.variation_removed,2e3)):jigoshop.addMessage("danger",r.error,6e3)}}(this))):void 0},t.prototype.connectImage=function(t,e){var r,a,i;return r=jQuery(e),a=r.next(".remove_variation_image"),i=jQuery("img",r.parent()),r.jigoshop_media({field:!1,bind:!1,thumbnail:i,callback:function(t){return a.show(),jQuery.ajax({url:jigoshop.getAjaxUrl(),type:"post",dataType:"json",data:{action:"jigoshop.admin.product.set_variation_image",product_id:r.closest(".jigoshop").data("id"),variation_id:r.closest(".variation").data("id"),image_id:t.id}}).done(function(t){return null!=t.success&&t.success?void 0:jigoshop.addMessage("danger",t.error,6e3)})},library:{type:"image"}})},t.prototype.setImage=function(t){return t.preventDefault(),jQuery(t.target).trigger("jigoshop_media")},t.prototype.removeImage=function(t){var e,r;return t.preventDefault(),e=jQuery(t.target),r=jQuery("img",e.parent()),jQuery.ajax({url:jigoshop.getAjaxUrl(),type:"post",dataType:"json",data:{action:"jigoshop.admin.product.set_variation_image",product_id:e.closest(".jigoshop").data("id"),variation_id:e.closest(".variation").data("id"),image_id:-1}}).done(function(t){return null!=t.success&&t.success?(r.attr("src",t.url).attr("width",150).attr("height",150),e.hide()):jigoshop.addMessage("danger",t.error,6e3)})},t}(),jQuery(function(){return new AdminProductVariable(jigoshop_admin_product_variable)});