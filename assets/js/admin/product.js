var AdminProduct,bind=function(t,e){return function(){return t.apply(e,arguments)}},hasProp={}.hasOwnProperty,indexOf=[].indexOf||function(t){for(var e=0,r=this.length;r>e;e++)if(e in this&&this[e]===t)return e;return-1};AdminProduct=function(){function t(t){this.params=t,this.removeAttribute=bind(this.removeAttribute,this),this.updateAttribute=bind(this.updateAttribute,this),this.addAttribute=bind(this.addAttribute,this),this.changeProductType=bind(this.changeProductType,this),jQuery("#add-attribute").on("click",this.addAttribute),jQuery("#new-attribute").on("change",function(t){var e;return e=jQuery("#new-attribute-label"),window.console.log(jQuery(t.target).val()),"-1"===jQuery(t.target).val()?(e.closest(".form-group").css("display","inline-block"),e.fadeIn()):e.fadeOut()}),jQuery("#product-attributes").on("click",".show-variation",function(t){var e;return e=jQuery(t.target),jQuery(".list-group-item-text",e.closest("li")).slideToggle(function(){return jQuery("span",e).toggleClass("glyphicon-collapse-down").toggleClass("glyphicon-collapse-up")})}),jQuery("#product-attributes").on("change","input, select",this.updateAttribute).on("click",".remove-attribute",this.removeAttribute),jQuery("#product-type").on("change",this.changeProductType),jQuery(".jigoshop_product_data a").on("click",function(t){return t.preventDefault(),jQuery(this).tab("show")}),jQuery("#stock-manage").on("change",function(){return jQuery(this).is(":checked")?(jQuery(".stock-status_field").slideUp(),jQuery(".stock-status").slideDown()):(jQuery(".stock-status_field").slideDown(),jQuery(".stock-status").slideUp())}),jQuery(".stock-status_field .not-active").show(),jQuery("#sales-enabled").on("change",function(){return jQuery(this).is(":checked")?jQuery(".schedule").slideDown():jQuery(".schedule").slideUp()}),jQuery("#is_taxable").on("change",function(){return jQuery(this).is(":checked")?jQuery(".tax_classes_field").slideDown():jQuery(".tax_classes_field").slideUp()}),jQuery(".tax_classes_field .not-active").show(),jQuery("#sales-from").datepicker({todayBtn:"linked",autoclose:!0}),jQuery("#sales-to").datepicker({todayBtn:"linked",autoclose:!0}),jQuery(".set-product-images").on("click","a",this.updateProductImages)}return t.prototype.params={ajax:"",i18n:{saved:"",confirm_remove:"",attribute_removed:"",invalid_attribute:"",attribute_without_label:""},menu:{}},t.prototype.productGalleryFrame="",t.prototype.changeProductType=function(t){var e,r,a,i;a=jQuery(t.target).val(),jQuery(".jigoshop_product_data li").hide(),e=this.params.menu;for(r in e)hasProp.call(e,r)&&(i=e[r],(i===!0||indexOf.call(i,a)>=0)&&jQuery(".jigoshop_product_data li."+r).show());return jQuery(".jigoshop_product_data li:first a").tab("show")},t.prototype.addAttribute=function(t){var e,r,a,i,u;return t.preventDefault(),a=jQuery("#product-attributes"),e=jQuery("#new-attribute"),r=jQuery("#new-attribute-label"),u=parseInt(e.val()),i=r.val(),0>u&&-1!==u?void addMessage("warning",this.params.i18n.invalid_attribute):-1===u&&0===i.length?void addMessage("danger",this.params.i18n.attribute_without_label,6e3):(e.select2("val",""),r.val("").slideUp(),u>0&&jQuery("option[value="+u+"]",e).attr("disabled","disabled"),jQuery.ajax({url:this.params.ajax,type:"post",dataType:"json",data:{action:"jigoshop.admin.product.save_attribute",product_id:a.closest(".jigoshop").data("id"),attribute_id:u,attribute_label:i}}).done(function(t){return null!=t.success&&t.success?jQuery(t.html).hide().appendTo(a).slideDown():addMessage("danger",t.error,6e3)}))},t.prototype.updateAttribute=function(t){var e,r,a,i,u,o,s,n,d,c,l;for(e=jQuery("#product-attributes"),r=jQuery(t.target).closest("li.list-group-item"),o=jQuery(".values input[type=checkbox]:checked",r).toArray(),o.length?u=o.reduce(function(t,e){return e.value+"|"+t},""):(u=jQuery(".values select",r).val(),void 0===u&&(u=jQuery(".values input",r).val())),a=function(t){return"checkbox"===t.type||"radio"===t.type?t.checked:t.value},d={},c=jQuery(".options input.attribute-options",r).toArray(),i=0,s=c.length;s>i;i++)n=c[i],l=/(?:^|\s)product\[attributes]\[\d+]\[(.*?)](?:\s|$)/g.exec(n.name),d[l[1]]=a(n);return jQuery.ajax({url:this.params.ajax,type:"post",dataType:"json",data:{action:"jigoshop.admin.product.save_attribute",product_id:e.closest(".jigoshop").data("id"),attribute_id:r.data("id"),value:u,options:d}}).done(function(t){return function(e){return null!=e.success&&e.success?addMessage("success",t.params.i18n.saved,2e3):addMessage("danger",e.error,6e3)}}(this))},t.prototype.removeAttribute=function(t){var e;return t.preventDefault(),confirm(this.params.i18n.confirm_remove)?(e=jQuery(t.target).closest("li"),jQuery("option[value="+e.data("id")+"]",jQuery("#new-attribute")).removeAttr("disabled"),jQuery.ajax({url:this.params.ajax,type:"post",dataType:"json",data:{action:"jigoshop.admin.product.remove_attribute",product_id:e.closest(".jigoshop").data("id"),attribute_id:e.data("id")}}).done(function(t){return function(r){return null!=r.success&&r.success?(e.slideUp(function(){return e.remove()}),addMessage("success",t.params.i18n.attribute_removed,2e3)):addMessage("danger",r.error,6e3)}}(this))):void 0},t.prototype.updateProductImages=function(t){var e,r,a,i;return t.preventDefault(),r=jQuery("#product-image-gallery"),i=r.find("ul.product-images"),e=jQuery(this),a=wp.media.frames.product_gallery=wp.media({title:e.data("choose"),button:{text:e.data("update")},states:[new wp.media.controller.Library({title:e.data("choose"),filterable:"all",multiple:!0})]}),a.on("select",function(){var t,e;return e=a.state().get("selection"),t=r.val(),e.map(function(t){return t=t.toJSON(),null!=t.id&&0===jQuery('input[name="product_images['+t.id+']"]').length?i.append('<input type="hidden" value="'+t.id+'" name="product_images['+t.id+']"/>'):void 0})}),a.open()},t}(),jQuery(function(){return new AdminProduct(jigoshop_admin_product)});