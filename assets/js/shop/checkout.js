var Checkout,bind=function(t,e){return function(){return t.apply(e,arguments)}},hasProp={}.hasOwnProperty;Checkout=function(){function t(t){this.params=t,this._updateShippingField=bind(this._updateShippingField,this),this.updateDiscounts=bind(this.updateDiscounts,this),this.updatePostcode=bind(this.updatePostcode,this),this.updateState=bind(this.updateState,this),this.updateCountry=bind(this.updateCountry,this),this.selectShipping=bind(this.selectShipping,this),this.block=bind(this.block,this),this._prepareStateField("#jigoshop_order_billing_address_state"),this._prepareStateField("#jigoshop_order_shipping_address_state"),jQuery("#jigoshop-login").on("click",function(t){return t.preventDefault(),jQuery("#jigoshop-login-form").slideToggle()}),jQuery("#create-account").on("change",function(){return jQuery("#registration-form").slideToggle()}),jQuery("#different_shipping_address").on("change",function(){return jQuery("#shipping-address").slideToggle(),jQuery(this).is(":checked")?jQuery("#jigoshop_order_shipping_address_country").change():jQuery("#jigoshop_order_billing_address_country").change()}),jQuery("#payment-methods").on("change","li input[type=radio]",function(){return jQuery("#payment-methods li > div").slideUp(),jQuery("div",jQuery(this).closest("li")).slideDown()}),jQuery("#shipping_address-calculator").on("click","input[type=radio]",this.selectShipping),jQuery("#jigoshop_order_billing_address_country").on("change",function(t){return function(e){return t.updateCountry("billing_address",e)}}(this)),jQuery("#jigoshop_order_shipping_address_country").on("change",function(t){return function(e){return t.updateCountry("shipping_address",e)}}(this)),jQuery("#jigoshop_order_billing_address_state").on("change",this.updateState.bind(this,"billing_address")),jQuery("#jigoshop_order_shipping_address_state").on("change",this.updateState.bind(this,"shipping_address")),jQuery("#jigoshop_order_billing_address_postcode").on("change",this.updatePostcode.bind(this,"billing_address")),jQuery("#jigoshop_order_shipping_address_postcode").on("change",this.updatePostcode.bind(this,"shipping_address")),jQuery("#jigoshop_coupons").on("change",this.updateDiscounts).select2({tags:[],tokenSeparators:[","],multiple:!0,formatNoMatches:""})}return t.prototype.params={ajax:"",assets:"",i18n:{loading:"Loading..."}},t.prototype.block=function(){return jQuery("#checkout > button").block({message:'<img src="'+this.params.assets+'/images/loading.gif" alt="'+this.params.i18n.loading+'" />',css:{padding:"20px",width:"auto",height:"auto",border:"1px solid #83AC31"},overlayCss:{opacity:.01}})},t.prototype.unblock=function(){return jQuery("#checkout > button").unblock()},t.prototype._prepareStateField=function(t){var e,s,i;return e=jQuery(t),e.is("select")?(s=jQuery(document.createElement("input")).attr("type","text").attr("id",e.attr("id")).attr("name",e.attr("name")).attr("class",e.attr("class")).val(e.val()),i=[],jQuery("option",e).each(function(){return i.push({id:jQuery(this).val(),text:jQuery(this).html()})}),e.replaceWith(s),s.select2({data:i})):void 0},t.prototype.selectShipping=function(){var t,e;return t=jQuery("#shipping_address-calculator input[type=radio]:checked"),e=jQuery(".shipping_address-method-rate",t.closest("li")),jQuery.ajax(this.params.ajax,{type:"post",dataType:"json",data:{action:"jigoshop_cart_select_shipping_address",method:t.val(),rate:e.val()}}).done(function(t){return function(e){return e.success?(t._updateTotals(e.html.total,e.html.subtotal),t._updateDiscount(e),t._updateTaxes(e.tax,e.html.tax)):addMessage("danger",e.error,6e3)}}(this))},t.prototype.updateCountry=function(t,e){return this.block(),jQuery(".noscript_state_field").remove(),jQuery.ajax(this.params.ajax,{type:"post",dataType:"json",data:{action:"jigoshop_checkout_change_country",field:t,differentShipping:jQuery("#different_shipping_address").is(":checked"),value:jQuery(e.target).val()}}).done(function(t){return function(s){var i,r,a,o,n;if(null!=s.success&&s.success)if(t._updateTotals(s.html.total,s.html.subtotal),t._updateDiscount(s),t._updateTaxes(s.tax,s.html.tax),t._updateShipping(s.shipping_address,s.html.shipping_address),n="#"+jQuery(e.target).attr("id").replace(/country/,"state"),s.has_states){i=[],a=s.states;for(o in a)hasProp.call(a,o)&&(r=a[o],i.push({id:o,text:r}));jQuery(n).select2({data:i})}else jQuery(n).attr("type","text").select2("destroy").val("");else addMessage("danger",s.error,6e3);return t.unblock()}}(this))},t.prototype.updateState=function(t){var e;return e="#jigoshop_order_"+t+"_state",this._updateShippingField("jigoshop_checkout_change_state",t,jQuery(e).val())},t.prototype.updatePostcode=function(t){var e;return e="#jigoshop_order_"+t+"_postcode",this._updateShippingField("jigoshop_checkout_change_postcode",t,jQuery(e).val())},t.prototype.updateDiscounts=function(t){var e;return e=jQuery(t.target),this.block(),jQuery.ajax(this.params.ajax,{type:"post",dataType:"json",data:{action:"jigoshop_cart_update_discounts",coupons:e.val()}}).done(function(t){return function(e){var s,i;if(null!=e.success&&e.success){if(null!=e.empty_cart==!0)return i=jQuery(e.html).hide(),s=jQuery("#cart"),s.after(i),s.slideUp(),i.slideDown(),void t.unblock();jQuery("td#product-subtotal").html(e.html.product_subtotal),t._updateTotals(e.html.total,e.html.subtotal),t._updateDiscount(e),t._updateTaxes(e.tax,e.html.tax),t._updateShipping(e.shipping_address,e.html.shipping_address)}else addMessage("danger",e.error,6e3);return t.unblock()}}(this))},t.prototype._updateShippingField=function(t,e,s){return this.block(),jQuery.ajax(this.params.ajax,{type:"post",dataType:"json",data:{action:t,field:e,differentShipping:jQuery("#different_shipping_address").is(":checked"),value:s}}).done(function(t){return function(e){return null!=e.success&&e.success?(t._updateTotals(e.html.total,e.html.subtotal),t._updateDiscount(e),t._updateTaxes(e.tax,e.html.tax),t._updateShipping(e.shipping_address,e.html.shipping_address)):addMessage("danger",e.error,6e3),t.unblock()}}(this))},t.prototype._updateTotals=function(t,e){return jQuery("#cart-total > td > strong").html(t),jQuery("#cart-subtotal > td").html(e)},t.prototype._updateDiscount=function(t){var e;return null!=t.coupons&&(jQuery("input#jigoshop_coupons").select2("val",t.coupons.split(",")),e=jQuery("tr#cart-discount"),t.discount>0?(jQuery("td",e).html(t.html.discount),e.show()):e.hide(),null!=t.html.coupons)?addMessage("warning",t.html.coupons):void 0},t.prototype._updateShipping=function(t,e){var s,i,r,a;for(r in t)hasProp.call(t,r)&&(a=t[r],i=jQuery(".shipping_address-"+r),i.addClass("existing"),i.length>0?a>-1?(s=jQuery(e[r].html).addClass("existing"),i.replaceWith(s)):i.slideUp(function(){return jQuery(this).remove()}):null!=e[r]&&(s=jQuery(e[r].html),s.hide().addClass("existing").appendTo(jQuery("#shipping_address-methods")).slideDown()));return jQuery("#shipping_address-methods > li:not(.existing)").slideUp(function(){return jQuery(this).remove()}),jQuery("#shipping_address-methods > li").removeClass("existing")},t.prototype._updateTaxes=function(t,e){var s,i,r,a;i=[];for(a in e)hasProp.call(e,a)&&(r=e[a],s=jQuery("#tax-"+a),jQuery("th",s).html(r.label),jQuery("td",s).html(r.value),t[a]>0?i.push(s.show()):i.push(s.hide()));return i},t}(),jQuery(function(){return new Checkout(jigoshop_checkout)});